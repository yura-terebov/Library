package database;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Scanner;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Main {

	private static final String INSERT_NEW = "INSERT INTO users (name, author) VALUES(?,?)";
	private static final String DELETE = "select name, author from users where name = ?";

	public static void main(String[] args) {
		DBWorker worker = new DBWorker();
		PreparedStatement preparedStatement = null;

		String query = "select * from users";
		try {
			Statement statement = worker.getConnection().createStatement();
			ResultSet resultSet = null;
			Scanner in = new Scanner(System.in);

			while (true) {
				String value = in.nextLine();

				if (value.equals("all books")) {
					System.out.println("Our books:");
					resultSet = statement.executeQuery(query);
					while (resultSet.next()) {
						User user = new User();
						user.setId(resultSet.getInt(1));
						user.setName(resultSet.getString(2));
						user.setAuthor(resultSet.getString(3));
						System.out.println("    " + user.toString());
					}
				} else if (value.startsWith("add ")) {
					preparedStatement = worker.getConnection().prepareStatement(INSERT_NEW);

					Pattern pattern = Pattern.compile("(\\w+)\\s+(.+)\\s+\"(.+)\"");

					Matcher matcher = pattern.matcher(value);
					if (matcher.matches()) {
						String command = matcher.group(1);
						String author = matcher.group(2);
						String book = matcher.group(3);

						preparedStatement.setString(2, author);
						preparedStatement.setString(1, book);

						preparedStatement.execute();
						System.out.println("book " + author + " " + book + " was added");
					}
				} else if (value.startsWith("remove ")) {
					preparedStatement = worker.getConnection().prepareStatement(DELETE);
					
					Pattern pattern = Pattern.compile("(\\w+)\\s+(.+)\\s+\"(.+)\"");

					Matcher matcher = pattern.matcher(value);
					if (matcher.matches()) {
						String command = matcher.group(1);
						String author = matcher.group(2);
						String book = matcher.group(3);
					}
					preparedStatement.setString(1, boo);
					resultSet = preparedStatement.executeQuery();

					int id = 1;
					while (resultSet.next()) {
						User user = new User();
						user.setName(resultSet.getString("name"));
						user.setAuthor(resultSet.getString("author"));
						System.out.println(id + ".   " + user.toString());
						id += 1;
					}
					resultSet.first();
					resultSet.absolute(in.nextInt());
					id = resultSet.getInt(id);
					statement.executeUpdate("delete from users where id = " + id);

					System.out.println("book " + values[1] + " was removed");
				} else if (value.startsWith("edit")) {

				}
			}

		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
